<!DOCTYPE html>
<html>
<head>
    <title>TikTok Video Downloader</title>
</head>
<body>
    <h1>TikTok Video Downloader</h1>
    <input type="text" id="tiktokUrl" placeholder="Paste TikTok URL here" size="50"/>
    <button onclick="fetchVideoInfo()">Get Info</button>
    <p id="videoInfo"></p>
    <button id="downloadBtn" style="display:none;">Download Video</button>

    <script>
        async function fetchVideoInfo() {
            const url = document.getElementById('tiktokUrl').value;
            const response = await fetch(`/get_video_info?url=${encodeURIComponent(url)}`);
            if (response.ok) {
                const data = await response.json();
                document.getElementById('videoInfo').innerText =
                    `Author: ${data.author_name}\nSong: ${data.song_name}\nDescription: ${data.description}`;
                // Setelah info diambil, otomatis mulai download
                downloadVideo();
            } else {
                alert("Gagal mendapatkan info video");
            }
        }

        async function downloadVideo() {
            const url = document.getElementById('tiktokUrl').value;
            const response = await fetch(`/download_video?url=${encodeURIComponent(url)}`);
            if (!response.ok) {
                alert("Gagal mendownload video");
                return;
            }
            const blob = await response.blob();
            const urlObject = URL.createObjectURL(blob);

            // Membuat link dan otomatis klik untuk download
            const a = document.createElement('a');
            a.href = urlObject;
            a.download = 'tiktok_video.mp4'; // Nama file
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(urlObject);
        }
    </script>
</body>
</html>